<template>
  <div class="home">
    <div id="loading">
      <svg
        id="todo"
        width="327"
        height="84"
        viewBox="0 0 327 84"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M8.78403 83.84H0.624023L27.408 0.895996H35.376L8.78403 83.84Z"
          stroke="#2c3e50"
          stroke-width="1"
        />
        <path
          d="M66.384 83.84H58.224L85.008 0.895996H92.976L66.384 83.84Z"
          stroke="#2c3e50"
          stroke-width="1"
        />
        <path
          d="M132.528 23.456H151.344V30.08H132.528V50.816C132.528 53.056 132.688 54.88 133.008 56.288C133.328 57.696 133.84 58.848 134.544 59.744C135.312 60.576 136.272 61.152 137.424 61.472C138.576 61.792 139.984 61.952 141.648 61.952C143.952 61.952 145.808 61.76 147.216 61.376C148.624 60.992 149.968 60.48 151.248 59.84L152.4 66.56C151.504 66.944 150.064 67.456 148.08 68.096C146.16 68.736 143.76 69.056 140.88 69.056C137.552 69.056 134.832 68.672 132.72 67.904C130.608 67.136 128.944 65.984 127.728 64.448C126.576 62.912 125.776 61.024 125.328 58.784C124.88 56.48 124.656 53.824 124.656 50.816V30.08H115.248V23.456H124.656V10.976L132.528 9.632V23.456Z"
          stroke="#2c3e50"
          stroke-width="1"
        />
        <path
          d="M210.96 45.728C210.96 49.248 210.448 52.448 209.424 55.328C208.464 58.144 207.088 60.576 205.296 62.624C203.504 64.672 201.36 66.272 198.864 67.424C196.368 68.512 193.648 69.056 190.704 69.056C187.824 69.056 185.136 68.512 182.64 67.424C180.208 66.272 178.096 64.672 176.304 62.624C174.512 60.576 173.104 58.144 172.08 55.328C171.12 52.448 170.64 49.248 170.64 45.728C170.64 42.208 171.12 39.008 172.08 36.128C173.104 33.248 174.512 30.816 176.304 28.832C178.096 26.784 180.208 25.216 182.64 24.128C185.136 22.976 187.824 22.4 190.704 22.4C193.648 22.4 196.368 22.976 198.864 24.128C201.36 25.216 203.504 26.784 205.296 28.832C207.088 30.816 208.464 33.248 209.424 36.128C210.448 39.008 210.96 42.208 210.96 45.728ZM202.8 45.728C202.8 40.672 201.712 36.704 199.536 33.824C197.36 30.88 194.416 29.408 190.704 29.408C187.056 29.408 184.144 30.88 181.968 33.824C179.856 36.704 178.8 40.672 178.8 45.728C178.8 50.72 179.856 54.688 181.968 57.632C184.144 60.512 187.056 61.952 190.704 61.952C194.416 61.952 197.36 60.512 199.536 57.632C201.712 54.688 202.8 50.72 202.8 45.728Z"
          stroke="#2c3e50"
          stroke-width="1"
        />
        <path
          d="M257.616 32.864C256.72 32.032 255.408 31.264 253.68 30.56C251.952 29.792 250.16 29.408 248.304 29.408C246.192 29.408 244.368 29.824 242.832 30.656C241.36 31.488 240.144 32.64 239.184 34.112C238.224 35.52 237.52 37.248 237.072 39.296C236.624 41.28 236.4 43.424 236.4 45.728C236.4 50.912 237.616 54.912 240.048 57.728C242.48 60.544 245.648 61.952 249.552 61.952C251.536 61.952 253.2 61.856 254.544 61.664C255.952 61.472 256.976 61.28 257.616 61.088V32.864ZM257.616 2.816L265.584 1.472V66.752C263.856 67.264 261.648 67.776 258.96 68.288C256.272 68.8 253.136 69.056 249.552 69.056C246.352 69.056 243.44 68.512 240.816 67.424C238.192 66.336 235.952 64.8 234.096 62.816C232.24 60.768 230.8 58.304 229.776 55.424C228.752 52.544 228.24 49.312 228.24 45.728C228.24 42.272 228.656 39.136 229.488 36.32C230.384 33.44 231.664 30.976 233.328 28.928C234.992 26.88 236.976 25.28 239.28 24.128C241.648 22.976 244.336 22.4 247.344 22.4C249.712 22.4 251.792 22.688 253.584 23.264C255.376 23.84 256.72 24.448 257.616 25.088V2.816Z"
          stroke="#2c3e50"
          stroke-width="1"
        />
        <path
          d="M326.16 45.728C326.16 49.248 325.648 52.448 324.624 55.328C323.664 58.144 322.288 60.576 320.496 62.624C318.704 64.672 316.56 66.272 314.064 67.424C311.568 68.512 308.848 69.056 305.904 69.056C303.024 69.056 300.336 68.512 297.84 67.424C295.408 66.272 293.296 64.672 291.504 62.624C289.712 60.576 288.304 58.144 287.28 55.328C286.32 52.448 285.84 49.248 285.84 45.728C285.84 42.208 286.32 39.008 287.28 36.128C288.304 33.248 289.712 30.816 291.504 28.832C293.296 26.784 295.408 25.216 297.84 24.128C300.336 22.976 303.024 22.4 305.904 22.4C308.848 22.4 311.568 22.976 314.064 24.128C316.56 25.216 318.704 26.784 320.496 28.832C322.288 30.816 323.664 33.248 324.624 36.128C325.648 39.008 326.16 42.208 326.16 45.728ZM318 45.728C318 40.672 316.912 36.704 314.736 33.824C312.56 30.88 309.616 29.408 305.904 29.408C302.256 29.408 299.344 30.88 297.168 33.824C295.056 36.704 294 40.672 294 45.728C294 50.72 295.056 54.688 297.168 57.632C299.344 60.512 302.256 61.952 305.904 61.952C309.616 61.952 312.56 60.512 314.736 57.632C316.912 54.688 318 50.72 318 45.728Z"
          stroke="#2c3e50"
          stroke-width="1"
        />
      </svg>
    </div>
    <div v-if="!loading">
      <ul id="todo-list">
        <transition-group name="list-complete" tag="p">
          <li v-for="todo of todos" :key="todo.id" class="list-complete-item">
            <Todo v-bind:todo="todo" @deleteTodo="onDeleteTodo" @toggleTodo="onToggleTodo" />
          </li>
        </transition-group>
      </ul>

      <transition enter-active-class="animate__animated animate__fadeInUp" appear>
        <Input @addTodo="onAddTodo" />
      </transition>
    </div>
  </div>
</template>

<script>
import Todo from "@/components/Todo.vue";
import Input from "@/components/Input.vue";
import db from "@/firebase";

export default {
  name: "Home",
  components: {
    Todo,
    Input
  },
  data() {
    return {
      todos: [],
      loading: true
    };
  },
  created() {
    setTimeout(() => {
      this.loading = false;
    }, 2000);
    this.$bind("todos", db.collection("todos")).then(todos => {
      this.todos === todos;
    });
  },
  firestore: {
    todos: db.collection("todos")
  },
  methods: {
    onAddTodo(todo) {
      let newTodo = { item: todo, complete: false };
      db.collection("todos")
        .add(newTodo)
        .then(() => {
          console.log("added");
        });
    },
    onDeleteTodo(id) {
      db.collection("todos")
        .doc(id)
        .delete()
        .then(() => {
          console.log("deleted");
        });
    },
    onToggleTodo(todo) {
      db.collection("todos")
        .doc(todo.id)
        .set({ complete: todo.complete }, { merge: true });
    }
  }
};
</script>

<style scoped>
.home {
  width: 70%;
  margin: auto;
  display: flex;
  flex-direction: column;
  flex-wrap: wrap;
}
ul {
  list-style-type: none;
  display: flex;
  flex-direction: column;
  text-align: left;
  padding-left: 0px;
}
.list-complete-item {
  transition: all 1s;
}
.list-complete-enter,
.list-complete-leave-to {
  opacity: 0;
  transform: translateY(30px);
}
/* loading animation */
@keyframes draw-line {
  to {
    stroke-dashoffset: 0;
  }
}

@keyframes fill-it {
  from {
    fill: transparent;
  }

  to {
    fill: #42b983;
  }
}

#todo {
  animation: fill-it 0.5s ease 2s forwards;
}

#todo path:nth-child(1) {
  stroke-dasharray: 190.4;
  stroke-dashoffset: 190.4;
  animation: draw-line 1s ease forwards;
}

#todo path:nth-child(2) {
  stroke-dasharray: 190.4;
  stroke-dashoffset: 190.4;
  animation: draw-line 1s ease 0.3s forwards;
}

#todo path:nth-child(3) {
  stroke-dasharray: 219.8;
  stroke-dashoffset: 219.8;
  animation: draw-line 1s ease 0.6s forwards;
}

#todo path:nth-child(4) {
  stroke-dasharray: 229.3;
  stroke-dashoffset: 229.3;
  animation: draw-line 1s ease 0.9s forwards;
}

#todo path:nth-child(5) {
  stroke-dasharray: 285.1;
  stroke-dashoffset: 285.1;
  animation: draw-line 1s ease 1.2s forwards;
}

#todo path:nth-child(6) {
  stroke-dasharray: 229.3;
  stroke-dashoffset: 229.3;
  animation: draw-line 1s ease 1.5s forwards;
}
</style>